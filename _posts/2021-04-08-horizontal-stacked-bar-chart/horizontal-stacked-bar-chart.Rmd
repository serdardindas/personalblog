---
title: "Horizontal Stacked Bar Chart"
description: |
  How to create single horizontal stacked bar chart with R
author:
  - name: Serdar DINDAS
    url: {}
date: 04-08-2021
output:
  distill::distill_article:
    toc: true
    css: styles.css
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Hello dear Rstats friends, with this post I will try to help you how you could create horizontal stacked bar chart. This is my first post i hope you enjoy.

Firstly i want to show you an example of horizontal stacked chart.

![](img/Unity_2021_Gaming_Report.png){width="800"}

This chart belongs to [Unity's 2021 GamingReport](https://img06.en25.com/Web/Unity/%7B4645ad28-63a3-4348-bc5b-dc09f2811419%7D_Unity_2021-Gaming-Report.pdf?elqTrackId=b795db85e6924d669757d6f8ef3db1a7&elqaid=3200&elqat=2){target="\"_blank"}. Unity is world's leading platform for creating games. If you're a person who is game developer you must heard of it.

So in this chart we will see 4 components. 3 of it is our charts, one of it its' labels. We will create this chart step by step.

We will use **ggplot** package to create each three charts, and **patchwork** package to combine all three charts. together.

### *STEP 1.* / Data and Packages

First we will call our packages

```{r}
library(ggplot2)
library(patchwork)
library(dplyr) # To use a little trick
```

Next we create our data frame

```{r}
 df <- data.frame(Results = c("Strongly Agree","Agree", "Neither agree nor disagree", "Disagree","Strongly Disagree"),
                       Proportion = c(50,19,6,13,13))

df <- df %>%  mutate(year=1) # This is little trick as I mentioned before. We add dummy variable like "year" as i used.
```

### *STEP 2.* / Simple Start

After this step lets try to make our first basic graph.

```{r fig.width=4, fig.height=4}
ggplot(df, aes(x = year , y = Proportion, fill = Results)) + geom_col()
```

You see bar plot is stacked but vertically. Colors are defined randomly.

### *STEP 3.* / Rest Of It `r emo::ji("smile")`

Now we can turn the bar plot horizontally with ***coord_flip()*** function.

```{r fig.width=12, fig.height=2}
ggplot(df, aes(x = year , y = Proportion, fill = Results)) + 
        geom_col()+
        coord_flip()
```

At this time if you look closely to the labels, You may notice a discrepancy in the ranking of legends, they sorted in alphabetical order. To avoid from this situation we will factorize **Results** column. This will help you to give all elements, in Results column, a specific order.

```{r fig.width=12, fig.height=2, layout="1-body_outset"}
df$Results <- factor(df$Results, levels = c("Strongly Agree","Agree", "Neither agree nor disagree",
                                            "Disagree","Strongly Disagree"))

ggplot(df, aes(x = year , y = Proportion, fill = Results)) + 
        geom_col()+
        coord_flip()
```

Now we can adjust the appearance of colors in this stage. You can use google chrome extension ["Eye Dropper"]{.important} to extract colors codes. I choose colors to match the original.

```{r fig.width=12, fig.height=2}

ggplot(df, aes(x = year , y = Proportion, fill = Results)) + 
        geom_col()+
        scale_fill_manual(values = c("#67bc6b","#d2e059","#ffcb27","#f37021","#ed5351"))+
       coord_flip()  


```

This time we need show percentages like **50, 19, 6, 13, 13** on graph by colors. To do this we use **geom_text()** functions , with position and size arguments.

```{r fig.width=12, fig.height=2}

ggplot(df, aes(x = year , y = Proportion, fill = Results)) + 
        geom_col()+
        geom_text(aes(label = paste0(Proportion, "%")), # Add labels "%" 
                      position = position_stack(vjust = 0.5), # Position each label center of each part.
                      size = 5)+ # Size of labels
        scale_fill_manual(values = c("#67bc6b","#d2e059","#ffcb27","#f37021","#ed5351"))+
        coord_flip() 

```

Now we change some appearance of graph inside **theme()** function. We can remove graph grids, title, ticks.

```{r fig.width=12, fig.height=2, preview=TRUE}
ggplot(df, aes(x = year , y = Proportion, fill = Results)) + 
        geom_col()+
        geom_text(aes(label = paste0(Proportion, "%")),
                      position = position_stack(vjust = 0.5), 
                      size = 5)+ 
        scale_fill_manual(values = c("#67bc6b","#d2e059","#ffcb27","#f37021","#ed5351"))+
        coord_flip()+ 
        theme(legend.position = "right",
              panel.grid.major = element_blank(), #Remove graphs grids, borders and background 
              panel.grid.minor = element_blank(),
              panel.border = element_blank(),
              panel.background = element_blank(), 
              axis.title = element_blank(), #Remove title, ticks and text parts
              axis.ticks = element_blank(),
              axis.text = element_blank(),
              legend.title = element_blank())+ #Remove title of legend
              guides(fill = guide_legend(reverse=TRUE)) # Reverse legend order as it shows in report.

```

After making this simple chart we can create 3 of them and combine together. This time we will use [**patchwork**](htthttps://patchwork.data-imaginist.com/ps://patchwork.data-imaginist.com/) package to glue them.

Let's create 3 part of horizontal stacked bar chart for different data. Each of this graphs will named [***p1, p2 and p3***]{.important}. If you want to check the code you can click **Show code**.

```{r, code_folding=TRUE}


df <- data.frame(Results = c("Strongly Agree","Agree", "Neither agree nor disagree", "Disagree","Strongly Disagree"),
                       Proportion = c(50,19,6,13,13))

df <- df %>%  mutate(year=1) 

df$Results <- factor(df$Results, levels = c("Strongly Agree","Agree",
                                            "Neither agree nor disagree","Disagree","Strongly Disagree"))

p1 <-ggplot(df, aes(x = year , y = Proportion, fill = Results)) + 
        geom_col()+
        geom_text(aes(label = paste0(Proportion, "%")),
                      position = position_stack(vjust = 0.5), 
                      size = 5)+ 
        scale_fill_manual(values = c("#67bc6b","#d2e059","#ffcb27","#f37021","#ed5351"))+
        coord_flip()+ 
        theme(legend.position = "right",
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.border = element_blank(),
              panel.background = element_blank(), 
              axis.title = element_blank(),
              axis.ticks = element_blank(),
              axis.text = element_blank(),
              legend.title = element_blank())+
              guides(fill = guide_legend(reverse=TRUE))

df2 <- df %>% mutate(Proportion2=c(25,25,13,13,6))

df3 <- df %>% mutate(Proportion3=c(19,25,19,25,13)) 


p2 <-ggplot(df2, aes(x = year , y = Proportion2, fill = Results)) + 
        geom_col()+
        geom_text(aes(label = paste0(Proportion2, "%")),
                      position = position_stack(vjust = 0.5), 
                      size = 5)+ 
        scale_fill_manual(values = c("#67bc6b","#d2e059","#ffcb27","#f37021","#ed5351"))+
        coord_flip()+ 
        theme(legend.position = "right",
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.border = element_blank(),
              panel.background = element_blank(), 
              axis.title = element_blank(),
              axis.ticks = element_blank(),
              axis.text = element_blank(),
              legend.title = element_blank())+
              guides(fill = guide_legend(reverse=TRUE))

p3 <-ggplot(df3, aes(x = year , y = Proportion3, fill = Results)) + 
        geom_col()+
        geom_text(aes(label = paste0(Proportion3, "%")),
                      position = position_stack(vjust = 0.5), 
                      size = 5)+ 
        scale_fill_manual(values = c("#67bc6b","#d2e059","#ffcb27","#f37021","#ed5351"))+
        coord_flip()+ 
        theme(legend.position = "right",
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.border = element_blank(),
              panel.background = element_blank(), 
              axis.title = element_blank(),
              axis.ticks = element_blank(),
              axis.text = element_blank(),
              legend.title = element_blank())+
              guides(fill = guide_legend(reverse=TRUE))

```

With **patchwork** package you can combine graphs side by side with **"+"** or under each other with **"/"**.

```{r fig.width=12, fig.height=5}
p1 / p2 / p3 & theme(legend.position = "right",
                     legend.text = element_text(size=15))
```

You see each graphs bring their legends with them. So legend part repeat 3 times. To prevent labels from repeating, we will add last line of code **plot_layout(guides = "collect")**

```{r fig.width=12, fig.height=3}
p <- p1 / p2 / p3 & theme(legend.position = "right",
                          legend.text = element_text(size=15))
                    
p + plot_layout(guides = "collect")
                    
```

I thinks two graphs nearly match except one point that Reports graph's legends at the top right but our graph's legend is at the middle right. I belive this can be ignored.

Thanks for reading my post. Please don't hesitate to say your feedback by [`r fontawesome::fa("twitter", fill = "steelblue", height=20)`](https://twitter.com/soncylon)

Also special thanks to my wife Zeliha Dindas for support and code review `r emo::ji("hug")`

\
\

------------------------------- **This Post Made with** `r fontawesome::fa("r-project", fill = "steelblue", height=20)` **by** `r emo::ji("heart")` ---------------------------------
